<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GATHER_SCHEMA_STATS &amp;#038; ORA-03001: unimplemented feature | My New Hugo Site</title>
    <link rel="stylesheet" href="/quickstart2/css/style.css" />
    <link rel="stylesheet" href="/quickstart2/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/quickstart2/">Home</a></li>
      
      <li><a href="/quickstart2/blog1/">Blog 1</a></li>
      
      <li><a href="/quickstart2/blog2/">Blog 2</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">GATHER_SCHEMA_STATS &amp; ORA-03001: unimplemented feature</span></h1>
<h2 class="author">Sidhu</h2>
<h2 class="date">2009/07/08</h2>
</div>

<main>
<p>Today i was gathering stats on one schema (10.2.0.3 on AIX 5.3, 64 bit) and it said:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;ERROR at line 1:
ORA-03001: unimplemented feature
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13336
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13682
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13760
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13719
ORA-06512: at line 1
</code></pre><p>Little bit of searching on Metalink revealed that i had hit Bug no 6011068 which points to the base <a href="https://metalink2.oracle.com/metalink/plsql/f?p=130:14:5335018637904207860::::p14_database_id,p14_docid,p14_show_header,p14_show_help,p14_black_frame,p14_font:NOT,559389.1,1,1,1,helvetica">Bug 576661</a> which is related to function based indexes. There were 2 function based indexes in the schema. Before talking about the workaround let us re-produce the test case. Here i am doing it on my laptop (10.2.0.1 on Windows XP 32 bit)</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;SCOTT@TESTING &gt;create table test1 as select * from emp;

Table created.

SCOTT@TESTING &gt;create index ind1 on test1(comm,1);

Index created.

SCOTT@TESTING &gt;

SYSTEM@TESTING&gt;exec dbms_stats.gather_schema_stats(&#39;SCOTT&#39;);
BEGIN dbms_stats.gather_schema_stats(&#39;SCOTT&#39;); END;

*
ERROR at line 1:
ORA-03001: unimplemented feature
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13210
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13556
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13634
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13593
ORA-06512: at line 1

SYSTEM@TESTING&gt;
</code></pre><p>As suggested in the metalink article let us set event 3001 before running the GATHER_SCHEMA_STATS command.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;SYSTEM@TESTING &gt;alter session set tracefile_identifier=stats1;

Session altered.

SYSTEM@TESTING &gt;alter session set events &#39;3001 trace name ERRORSTACK level 3&#39;;

Session altered.

SYSTEM@TESTING &gt;exec dbms_stats.gather_schema_stats(&#39;SCOTT&#39;);
BEGIN dbms_stats.gather_schema_stats(&#39;SCOTT&#39;); END;

*
ERROR at line 1:
ORA-03001: unimplemented feature
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13210
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13556
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13634
ORA-06512: at &#34;SYS.DBMS_STATS&#34;, line 13593
ORA-06512: at line 1

SYSTEM@TESTING &gt;
</code></pre><p>Part of the trace file reads:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;ksedmp: internal or fatal error
ORA-03001: unimplemented feature
Current SQL statement for this session:
select /*+ no_parallel_index(t,IND1) dbms_stats cursor_sharing_exact use_weak_name_resl dynamic_sampling(0) no_monitoring no_expand index(t,&#34;IND1&#34;) */ count(*) as nrw,count(distinct sys_op_lbid(51966,&#39;L&#39;,t.rowid)) as nlb,count(distinct hextoraw(sys_op_descend(&#34;COMM&#34;)||sys_op_descend(1))) as ndk,sys_op_countchg(substrb(t.rowid,1,15),1) as clf from &#34;SCOTT&#34;.&#34;TEST1&#34; t where &#34;COMM&#34; is not null or 1 is not null
----- PL/SQL Call Stack -----
object      line  object
handle    number  name
65AA77D4      9406  package body SYS.DBMS_STATS
65AA77D4      9919  package body SYS.DBMS_STATS
</code></pre><p>So the problem is being caused by the index ind1 we created on (comm,1). This bug has been fixed in 10.2.0.5 and 11.1.0.7. The available workaround for other versions is to create index using 1 as character instead of number.</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;SCOTT@TESTING &gt;drop index ind1;

Index dropped.

SCOTT@TESTING &gt;create index ind1 on test1(comm,&#39;1&#39;);

Index created.

SCOTT@TESTING &gt;
</code></pre><p>And now running GATHER_SCHEMA_STATS:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;brush: sql; title: ; notranslate&#34; title=&#34;&#34;&gt;SYSTEM@TESTING &gt;exec dbms_stats.gather_schema_stats(&#39;SCOTT&#39;);

PL/SQL procedure successfully completed.

SYSTEM@TESTING &gt;
</code></pre>
</main>

  <footer>
  
  
  </footer>
  </body>
</html>

